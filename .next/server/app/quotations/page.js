(()=>{var e={};e.id=819,e.ids=[819],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},7015:(e,s,t)=>{"use strict";t.r(s),t.d(s,{GlobalError:()=>n.a,__next_app__:()=>m,originalPathname:()=>x,pages:()=>o,routeModule:()=>u,tree:()=>c}),t(1123),t(5967),t(5866);var a=t(3191),r=t(8716),l=t(7922),n=t.n(l),i=t(5231),d={};for(let e in i)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>i[e]);t.d(s,d);let c=["",{children:["quotations",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,1123)),"C:\\Users\\stamm\\AMPERE WEBAPP\\src\\app\\quotations\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,5967)),"C:\\Users\\stamm\\AMPERE WEBAPP\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,5866,23)),"next/dist/client/components/not-found-error"]}],o=["C:\\Users\\stamm\\AMPERE WEBAPP\\src\\app\\quotations\\page.tsx"],x="/quotations/page",m={require:t,loadChunk:()=>Promise.resolve()},u=new a.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/quotations/page",pathname:"/quotations",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},9773:(e,s,t)=>{Promise.resolve().then(t.bind(t,7241))},949:(e,s,t)=>{"use strict";t.d(s,{Z:()=>a});let a=(0,t(2881).Z)("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},7241:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>_});var a=t(326),r=t(7577),l=t(434),n=t(4471),i=t(9682),d=t(5956),c=t(9105),o=t(9884),x=t(4468),m=t(3855),u=t(361),p=t(4019),h=t(6283),g=t(1821),j=t(7069),f=t(8998),b=t(8307),v=t(8393),N=t(4061),y=t(7358),w=t(949),P=t(3869),C=t(9508),q=t(8091),Z=t(1223);let A={draft:"bg-gray-100 text-gray-800",pending_approval:"bg-yellow-100 text-yellow-800",sent:"bg-blue-100 text-blue-800",accepted:"bg-green-100 text-green-800",rejected:"bg-red-100 text-red-800",expired:"bg-orange-100 text-orange-800",converted:"bg-purple-100 text-purple-800"},E={draft:"Draft",pending_approval:"Pending Approval",sent:"Sent",accepted:"Accepted",rejected:"Rejected",expired:"Expired",converted:"Converted"};function _(){let{user:e}=(0,n.a)(),{quotations:s,addQuotation:t,updateQuotation:_,deleteQuotation:S}=(0,d._)(),{clients:k}=(0,i.a)(),[D,M]=(0,r.useState)(""),[L,Q]=(0,r.useState)("all"),[T,R]=(0,r.useState)("all"),[U,G]=(0,r.useState)(!1),[I,V]=(0,r.useState)(),[B,W]=(0,r.useState)(!1),[O,z]=(0,r.useState)(""),[$,F]=(0,r.useState)(!1),[X,H]=(0,r.useState)(),J=(0,r.useMemo)(()=>{let e=s.reduce((e,s)=>e+s.totalAmount,0),t=s.filter(e=>"accepted"===e.status),a=t.reduce((e,s)=>e+s.totalAmount,0),r=s.filter(e=>"sent"===e.status).length,l=s.filter(e=>["accepted","rejected","expired"].includes(e.status)).length>0?Math.round(t.length/s.filter(e=>["accepted","rejected","expired"].includes(e.status)).length*100):0;return{total:s.length,totalValue:e,acceptedValue:a,sentQuotations:r,conversionRate:l}},[s]),K=(0,r.useMemo)(()=>s.filter(e=>{let s=k.find(s=>s.id===e.clientId),t=e.title.toLowerCase().includes(D.toLowerCase())||e.quotationNumber.toLowerCase().includes(D.toLowerCase())||e.description.toLowerCase().includes(D.toLowerCase())||s?.name.toLowerCase().includes(D.toLowerCase()),a="all"===L||e.status===L,r="all"===T||e.clientId===T;return t&&a&&r}),[s,k,D,L,T]),Y=e=>{let s=new Date;return Math.ceil((new Date(e).getTime()-s.getTime())/864e5)},ee=e=>new Intl.NumberFormat("en-SG",{style:"currency",currency:"SGD"}).format(e),es=e=>{V(e),G(!0)},et=async e=>{W(!0),z("");try{await new Promise(e=>setTimeout(e,1e3)),I?(_(I.id,e),z("Quotation updated successfully!")):(t(e),z("Quotation created successfully!")),G(!1),V(void 0),setTimeout(()=>{z("")},3e3)}catch(e){console.error("Error saving quotation:",e)}finally{W(!1)}},ea=async e=>{W(!0),z("");try{await new Promise(e=>setTimeout(e,1e3)),S(e.id),z(`Quotation "${e.quotationNumber}" deleted successfully!`),F(!1),H(void 0),setTimeout(()=>{z("")},3e3)}catch(e){console.error("Error deleting quotation:",e)}finally{W(!1)}},er=e=>{H(e),F(!0)},el=e=>{let s=k.find(s=>s.id===e.clientId);(0,c.n)(e,s)};return e?(0,a.jsxs)(o.Z,{user:e,children:[(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[a.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Quotations"}),a.jsx("p",{className:"text-gray-600",children:"Manage quotations and track business opportunities"})]}),("super_admin"===e.role||"admin"===e.role||"sales"===e.role||"finance"===e.role)&&(0,a.jsxs)("button",{onClick:()=>{V(void 0),G(!0)},className:"btn-primary flex items-center space-x-2",children:[a.jsx(m.Z,{className:"h-4 w-4"}),a.jsx("span",{children:"Create Quotation"})]})]}),O&&(0,a.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[a.jsx(u.Z,{className:"h-5 w-5 text-green-600"}),a.jsx("span",{className:"text-green-800 font-medium",children:O})]}),a.jsx("button",{onClick:()=>z(""),className:"text-green-600 hover:text-green-800 p-1 rounded-lg hover:bg-green-100",children:a.jsx(p.Z,{className:"h-4 w-4"})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-6",children:[a.jsx("div",{className:"metric-card",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[a.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Quotations"}),a.jsx("p",{className:"text-2xl font-bold text-gray-900",children:J.total})]}),a.jsx(h.Z,{className:"h-8 w-8 text-ampere-600"})]})}),a.jsx("div",{className:"metric-card",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[a.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Value"}),a.jsx("p",{className:"text-2xl font-bold text-ampere-600",children:ee(J.totalValue)})]}),a.jsx(g.Z,{className:"h-8 w-8 text-ampere-600"})]})}),a.jsx("div",{className:"metric-card",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[a.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Accepted Value"}),a.jsx("p",{className:"text-2xl font-bold text-green-600",children:ee(J.acceptedValue)})]}),a.jsx(j.Z,{className:"h-8 w-8 text-green-600"})]})}),a.jsx("div",{className:"metric-card",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[a.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Pending Response"}),a.jsx("p",{className:"text-2xl font-bold text-blue-600",children:J.sentQuotations})]}),a.jsx(f.Z,{className:"h-8 w-8 text-blue-600"})]})}),a.jsx("div",{className:"metric-card",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[a.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Conversion Rate"}),(0,a.jsxs)("p",{className:"text-2xl font-bold text-purple-600",children:[J.conversionRate,"%"]})]}),a.jsx(j.Z,{className:"h-8 w-8 text-purple-600"})]})})]}),a.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:(0,a.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[a.jsx("div",{className:"flex-1",children:(0,a.jsxs)("div",{className:"relative",children:[a.jsx(b.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),a.jsx("input",{type:"text",placeholder:"Search quotations by title, number, client, or description...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-ampere-500 focus:border-ampere-500",value:D,onChange:e=>M(e.target.value)})]})}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)("select",{className:"appearance-none bg-white border border-gray-300 rounded-lg px-4 py-2 pr-8 focus:ring-2 focus:ring-ampere-500 focus:border-ampere-500",value:L,onChange:e=>Q(e.target.value),children:[a.jsx("option",{value:"all",children:"All Status"}),Object.entries(E).map(([e,s])=>a.jsx("option",{value:e,children:s},e))]}),a.jsx(v.Z,{className:"absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4 pointer-events-none"})]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)("select",{className:"appearance-none bg-white border border-gray-300 rounded-lg px-4 py-2 pr-8 focus:ring-2 focus:ring-ampere-500 focus:border-ampere-500",value:T,onChange:e=>R(e.target.value),children:[a.jsx("option",{value:"all",children:"All Clients"}),k.filter(e=>"active"===e.status).map(e=>a.jsx("option",{value:e.id,children:e.name},e.id))]}),a.jsx(v.Z,{className:"absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4 pointer-events-none"})]})]})}),(0,a.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200",children:[a.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:a.jsx("div",{className:"flex items-center justify-between",children:(0,a.jsxs)("h2",{className:"text-lg font-semibold text-gray-900",children:["Quotations (",K.length,")"]})})}),a.jsx("div",{className:"overflow-hidden",children:K.map(s=>{let t=k.find(e=>e.id===s.clientId),r=Y(s.validUntil);return(0,a.jsxs)("div",{className:"relative",children:[a.jsx(l.default,{href:`/quotations/${s.id}`,children:a.jsx("div",{className:"p-6 hover:bg-gray-50 transition-colors cursor-pointer border-b border-gray-200 last:border-b-0",children:a.jsx("div",{className:"flex items-center justify-between",children:a.jsx("div",{className:"flex-1",children:(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[a.jsx("div",{className:"flex-shrink-0",children:a.jsx("div",{className:"w-12 h-12 bg-ampere-100 rounded-lg flex items-center justify-center",children:a.jsx(h.Z,{className:"h-6 w-6 text-ampere-600"})})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s.title}),a.jsx("span",{className:(0,Z.cn)("px-2 py-1 text-xs font-medium rounded-full",A[s.status]),children:E[s.status]})]}),(0,a.jsxs)("div",{className:"mt-2 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 text-sm text-gray-600",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[a.jsx(N.Z,{className:"h-4 w-4"}),a.jsx("span",{children:t?.name||"Unknown Client"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[a.jsx(h.Z,{className:"h-4 w-4"}),a.jsx("span",{children:s.quotationNumber})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[a.jsx(g.Z,{className:"h-4 w-4"}),a.jsx("span",{children:ee(s.totalAmount)})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[a.jsx(y.Z,{className:"h-4 w-4"}),(0,a.jsxs)("span",{children:["Valid until ",new Date(s.validUntil).toLocaleDateString()]})]})]}),(0,a.jsxs)("div",{className:"mt-3 flex items-center space-x-6 text-sm",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[a.jsx("span",{className:"font-medium text-gray-700",children:"Created:"}),a.jsx("span",{children:new Date(s.createdAt).toLocaleDateString()})]}),"sent"===s.status&&(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[a.jsx("span",{className:"font-medium text-gray-700",children:"Sent:"}),a.jsx("span",{children:s.sentDate?new Date(s.sentDate).toLocaleDateString():"Not sent"})]}),"sent"===s.status&&r<=3&&r>0&&(0,a.jsxs)("div",{className:"flex items-center space-x-1 text-orange-600",children:[a.jsx(w.Z,{className:"h-4 w-4"}),(0,a.jsxs)("span",{children:[r," days left"]})]}),"sent"===s.status&&r<=0&&(0,a.jsxs)("div",{className:"flex items-center space-x-1 text-red-600",children:[a.jsx(w.Z,{className:"h-4 w-4"}),a.jsx("span",{children:"Expired"})]})]}),a.jsx("p",{className:"mt-2 text-sm text-gray-600 line-clamp-2",children:s.description})]})]})})})})}),(0,a.jsxs)("div",{className:"absolute top-6 right-6 flex items-center space-x-2",children:[a.jsx("button",{onClick:e=>{e.preventDefault(),e.stopPropagation(),el(s)},className:"p-2 text-gray-400 hover:text-ampere-600 rounded-lg hover:bg-gray-100 bg-white shadow-sm border",title:"Print Quotation",children:a.jsx(P.Z,{className:"h-4 w-4"})}),("super_admin"===e.role||"admin"===e.role||"sales"===e.role)&&"draft"===s.status&&a.jsx("button",{onClick:e=>{e.preventDefault(),e.stopPropagation(),es(s)},className:"p-2 text-gray-400 hover:text-blue-600 rounded-lg hover:bg-blue-50 bg-white shadow-sm border",title:"Edit Quotation",children:a.jsx(C.Z,{className:"h-4 w-4"})}),("super_admin"===e.role||"admin"===e.role)&&a.jsx("button",{onClick:e=>{e.preventDefault(),e.stopPropagation(),er(s)},className:"p-2 text-gray-400 hover:text-red-600 rounded-lg hover:bg-red-50 bg-white shadow-sm border",title:"Delete Quotation",children:a.jsx(q.Z,{className:"h-4 w-4"})})]})]},s.id)})}),0===K.length&&(0,a.jsxs)("div",{className:"p-12 text-center",children:[a.jsx(h.Z,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),a.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No quotations found"}),a.jsx("p",{className:"text-gray-600",children:"Try adjusting your search criteria or create a new quotation."})]})]})]}),a.jsx(x.Z,{quotation:I,isOpen:U,onClose:()=>{G(!1),V(void 0)},onSave:et,mode:I?"edit":"add",isLoading:B}),$&&X&&a.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:(0,a.jsxs)("div",{className:"flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0",children:[a.jsx("div",{className:"fixed inset-0 transition-opacity","aria-hidden":"true",children:a.jsx("div",{className:"absolute inset-0 bg-gray-500 opacity-75"})}),(0,a.jsxs)("div",{className:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full",children:[a.jsx("div",{className:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4",children:(0,a.jsxs)("div",{className:"sm:flex sm:items-start",children:[a.jsx("div",{className:"mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-100 sm:mx-0 sm:h-10 sm:w-10",children:a.jsx(q.Z,{className:"h-6 w-6 text-red-600"})}),(0,a.jsxs)("div",{className:"mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left",children:[a.jsx("h3",{className:"text-lg leading-6 font-medium text-gray-900",children:"Delete Quotation"}),a.jsx("div",{className:"mt-2",children:(0,a.jsxs)("p",{className:"text-sm text-gray-500",children:["Are you sure you want to delete quotation ",a.jsx("strong",{children:X.quotationNumber})," - ",a.jsx("strong",{children:X.title}),"? This action cannot be undone."]})})]})]})}),(0,a.jsxs)("div",{className:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse",children:[a.jsx("button",{type:"button",onClick:()=>ea(X),disabled:B,className:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 sm:ml-3 sm:w-auto sm:text-sm disabled:opacity-50 disabled:cursor-not-allowed",children:B?(0,a.jsxs)("div",{className:"flex items-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Deleting..."]}):"Delete"}),a.jsx("button",{type:"button",onClick:()=>{F(!1),H(void 0)},disabled:B,className:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"})]})]})]})})]}):null}},1123:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>a});let a=(0,t(8570).createProxy)(String.raw`C:\Users\stamm\AMPERE WEBAPP\src\app\quotations\page.tsx#default`)}};var s=require("../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),a=s.X(0,[935,910,370,884,891],()=>t(7015));module.exports=a})();